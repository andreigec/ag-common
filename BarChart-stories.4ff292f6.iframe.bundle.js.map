{"version":3,"file":"BarChart-stories.4ff292f6.iframe.bundle.js","mappings":";;;;;;;AAiBA;;;AAKA;;;ACTA;;;;;;;AAQA;;;;;;AAQA;;;;;;;AASA;;;;;;AAOA;;;;;;AAQA;;;;;AAOA;;ACjDA;;AAGA;;;AAKA;;;;;AAMA;;;;;;;;AAUA;;;;;;;AChBA;;;;;;;;AAUA;;;ACFA;ACfA;AAGA;;;;;;AAoBA;;AAGA;;;;AAMA;;;;;;AAwBA;;;AAyBA;;;;;;;;AAZA;AAYA;;;;;;;;;;;;;;;;;;;;;;AChEA;;;AAKA;;;AAKA;;AAIA;;;;;AAKA;;;AAKA","sources":["webpack://ag-common/./src/ui/components/BarChart/Item.tsx","webpack://ag-common/./src/ui/components/BarChart/Legend.tsx","webpack://ag-common/./src/ui/components/BarChart/TooltipContent.tsx","webpack://ag-common/./src/ui/components/BarChart/Base.tsx","webpack://ag-common/./src/ui/helpers/useTooltip.tsx","webpack://ag-common/./src/ui/styles/common.tsx","webpack://ag-common/./src/ui/styles/standaloneStyles.ts"],"sourcesContent":["import styled from '@emotion/styled';\nimport type { MouseEventHandler } from 'react';\nimport React from 'react';\n\nimport type { IVarStyles } from '../../styles';\nimport { HardOutlineFilter } from '../../styles';\nimport type { IBarChartData } from './types';\n\nconst Base = styled.div`\n  display: flex;\n  flex-flow: row;\n  width: 100%;\n  height: 100%;\n  cursor: default;\n  position: relative;\n`;\n\nconst Title = styled.div`\n  position: absolute;\n  left: 0.25rem;\n`;\n\nexport const Item = ({\n  data,\n  className,\n  onMouseMove,\n  onMouseLeave,\n  maxWidth,\n  style,\n}: {\n  data: IBarChartData;\n  className?: string;\n  onMouseMove?: MouseEventHandler<HTMLDivElement>;\n  onMouseLeave?: MouseEventHandler<HTMLDivElement>;\n  maxWidth: number;\n  style: IVarStyles;\n}) => (\n  <Base\n    className={className}\n    onMouseMove={onMouseMove}\n    onMouseLeave={onMouseLeave}\n    style={style}\n    data-type=\"bcb-item\"\n  >\n    <Title\n      style={{\n        color: style.color,\n        filter: HardOutlineFilter(style.backgroundColor),\n        whiteSpace: 'nowrap',\n      }}\n    >\n      {data.name}\n    </Title>\n    {data.values.map((v) => (\n      <div\n        data-barchartitem-key={v.name}\n        key={v.name}\n        style={{\n          height: '100%',\n          width: `${(v.value / maxWidth) * 100}%`,\n          backgroundColor: v.colour,\n        }}\n      >\n        &nbsp;\n      </div>\n    ))}\n    <div\n      style={{\n        height: '100%',\n        flexGrow: 1,\n        backgroundColor: 'transparent',\n      }}\n    >\n      &nbsp;\n    </div>\n  </Base>\n);\n","import styled from '@emotion/styled';\nimport React from 'react';\n\nimport { distinctBy, flat } from '../../../common/helpers/array';\nimport type { IVarStyles } from '../../styles/common';\nimport { getLegendItems } from './getLegendItems';\nimport type { IBarChartData } from './types';\n\nconst Base = styled.div`\n  display: flex;\n  flex-flow: column;\n`;\n\nconst Bar = styled.div`\n  width: 100%;\n  height: 1rem;\n  display: flex;\n  flex-flow: row;\n  position: relative;\n  margin-bottom: 0.25rem;\n`;\nconst Line = styled.div`\n  position: absolute;\n  top: calc(50% - 1px);\n  height: 2px;\n  left: 0;\n  right: 0;\n`;\n\nconst Numbers = styled.div`\n  width: 100%;\n  height: 1rem;\n  display: flex;\n  flex-flow: row;\n  justify-content: space-between;\n  z-index: 1;\n`;\n\nconst Items = styled.div`\n  width: 100%;\n  display: flex;\n  flex-flow: row wrap;\n  position: relative;\n  justify-content: space-between;\n`;\nconst Item = styled.div`\n  display: flex;\n  flex-flow: row;\n  position: relative;\n  align-items: center;\n  flex-basis: 25%;\n`;\n\nconst Col = styled.div`\n  width: 1rem;\n  height: 1rem;\n  border-radius: 50%;\n  margin-right: 0.25rem;\n`;\n\nexport const Legend = ({\n  data,\n  maxWidth,\n  style,\n}: {\n  data: IBarChartData[];\n  maxWidth: number;\n  style: IVarStyles;\n}) => {\n  const items = [0];\n  if (maxWidth > 10) {\n    items.push(Math.floor(maxWidth * 0.25));\n    items.push(Math.floor(maxWidth * 0.5));\n    items.push(Math.floor(maxWidth * 0.75));\n  }\n  items.push(maxWidth);\n\n  const keys = distinctBy(\n    flat(\n      data.map((data) => {\n        return getLegendItems({ data }).part.map((v) => ({\n          colour: v.colour,\n          name: v.name,\n        }));\n      }),\n    ),\n    (s) => s.name,\n  ).sort((a, b) => (a.name < b.name ? -1 : 1));\n\n  return (\n    <Base style={style}>\n      <Bar>\n        <Line\n          style={{ background: style.backgroundColor, color: style.color }}\n        />\n        <Numbers>\n          {items.map((i) => (\n            <span\n              style={{\n                backgroundColor: style.backgroundColor,\n                color: style.color,\n              }}\n              key={i}\n            >\n              {i}\n            </span>\n          ))}\n        </Numbers>\n      </Bar>\n      {keys.length > 1 && (\n        <Items>\n          {keys.map((k) => (\n            <Item key={k.name}>\n              <Col style={{ backgroundColor: k.colour }} />\n              {k.name}\n            </Item>\n          ))}\n        </Items>\n      )}\n    </Base>\n  );\n};\n","import styled from '@emotion/styled';\nimport React from 'react';\n\nimport type { IVarStyles } from '../../styles/common';\nimport { getLegendItems } from './getLegendItems';\nimport type { IBarChartData } from './types';\n\nconst Base = styled.div`\n  padding: 0.5rem;\n`;\n\nconst Title = styled.div`\n  font-weight: bold;\n`;\nconst Row = styled.div`\n  width: 100%;\n  display: flex;\n`;\n\nconst ItemTitle = styled.span`\n  &[data-selected='true'] {\n    font-weight: bold;\n    text-decoration: underline;\n  }\n`;\nconst Total = styled.span`\n  margin-left: auto;\n  padding-left: 0.5rem;\n\n  &[data-selected='true'] {\n    font-weight: bold;\n    text-decoration: underline;\n  }\n`;\n\nexport const TooltipContent = ({\n  data,\n  selectedKey,\n  style,\n}: {\n  data: IBarChartData;\n  selectedKey?: string;\n  style: IVarStyles;\n}) => {\n  const { part, rest, restTotal } = getLegendItems({ data, selectedKey });\n\n  return (\n    <Base\n      style={{\n        ...style,\n        border: `solid 1px ${style.borderColor}`,\n      }}\n    >\n      <Title>{data.name}</Title>\n      <Row>\n        <span>total</span>\n        <Total>{data.total}</Total>\n      </Row>\n      {part.map((v) => (\n        <Row style={{ color: v.colour }} key={v.name}>\n          <ItemTitle data-selected={selectedKey === v.name}>{v.name}</ItemTitle>\n          <Total data-selected={selectedKey === v.name}>{v.value}</Total>\n        </Row>\n      ))}\n      {rest.length > 0 && (\n        <Row>\n          <span>{rest.length} more</span>\n          <Total>{restTotal}</Total>\n        </Row>\n      )}\n    </Base>\n  );\n};\n","import styled from '@emotion/styled';\nimport React from 'react';\n\nimport { useTooltip } from '../../helpers/useTooltip';\nimport { getVarStyles, type IVarStyles } from '../../styles/common';\nimport { Item } from './Item';\nimport { Legend } from './Legend';\nimport { TooltipContent } from './TooltipContent';\nimport type { IBarChartData } from './types';\n\nconst BarChartBase = styled.div`\n  display: flex;\n  flex-flow: column;\n  width: 100%;\n  height: 100%;\n  margin-top: 0.5rem;\n  position: relative;\n`;\n\nconst ItemStyled = styled(Item)`\n  margin-bottom: 0.75rem;\n  height: auto;\n  overflow: hidden;\n\n  &:last-of-type {\n    margin-bottom: 0;\n  }\n`;\n\nexport const BarChart = ({\n  data: dataRaw,\n  style: sRaw,\n  className,\n}: {\n  data: IBarChartData[];\n  style?: Partial<IVarStyles>;\n  className?: string;\n}) => {\n  const style = getVarStyles(sRaw);\n  const UT = useTooltip<{ selectedKey?: string; data: IBarChartData }>();\n\n  const maxWidth = Math.max(...dataRaw.map((a) => a.total));\n\n  return (\n    <BarChartBase data-type=\"bcb\" style={style} className={className}>\n      <UT.Comp pos={UT.pos}>\n        {({ data }) => <TooltipContent {...data} style={style} />}\n      </UT.Comp>\n      {dataRaw.map((data) => (\n        <ItemStyled\n          style={style}\n          key={data.name}\n          data={data}\n          maxWidth={maxWidth}\n          onMouseLeave={() => UT.setPos(undefined)}\n          onMouseMove={(element) => {\n            const selectedKey =\n              document\n                .elementFromPoint(element.pageX, element.pageY)\n                ?.getAttribute('data-barchartitem-key') ?? '';\n            UT.setPos({\n              element,\n              parent: element.currentTarget.closest(\"[data-type='bcb']\"),\n              data: { selectedKey, data },\n            });\n          }}\n        />\n      ))}\n      <Legend data={dataRaw} maxWidth={maxWidth} style={style} />\n    </BarChartBase>\n  );\n};\n","import styled from '@emotion/styled';\nimport type { MouseEvent } from 'react';\nimport type { JSX } from 'react';\nimport React, { createRef, useEffect, useState } from 'react';\nimport { createPortal } from 'react-dom';\n\nconst Base = styled.div`\n  position: absolute;\n  z-index: 10;\n`;\n\ninterface IPos<T> {\n  cursor: MouseEvent;\n  data: T;\n  portalId: string;\n  hasParent: boolean;\n  parentWidth: number;\n  parentHeight: number;\n  x: number;\n  y: number;\n}\n\ninterface IPosSize {\n  tooltipWidth: number;\n  tooltipHeight: number;\n}\n\nconst Comp = <T,>({\n  pos,\n  children,\n}: {\n  pos: IPos<T> | undefined;\n  children: (pos: IPos<T>, size?: IPosSize) => JSX.Element;\n}) => {\n  const ref = createRef<HTMLDivElement>();\n  const [size, setSize] = useState<IPosSize>();\n\n  useEffect(() => {\n    if (!ref.current || size) {\n      return;\n    }\n    const tooltipWidth = Math.max(\n      ref.current.clientWidth,\n      ref.current.scrollWidth,\n    );\n    const tooltipHeight = Math.max(\n      ref.current.clientHeight,\n      ref.current.scrollHeight,\n    );\n    if (tooltipHeight === 0 || tooltipWidth === 0) {\n      return;\n    }\n    setSize({\n      tooltipWidth,\n      tooltipHeight,\n    });\n  }, [ref, size]);\n\n  if (!pos) {\n    return null;\n  }\n\n  let left: number | undefined;\n  let right: number | undefined;\n  let top: number | undefined;\n  let bottom: number | undefined;\n  const gap = 5;\n  if (size) {\n    left = pos.x + gap;\n    const newRight = pos.parentWidth - pos.x + gap;\n\n    if (pos.x + gap + size.tooltipWidth > pos.parentWidth) {\n      left = undefined;\n      right = newRight;\n    }\n    //\n    top = pos.y + gap;\n\n    if (top + size.tooltipHeight > pos.parentHeight) {\n      if (pos.hasParent) {\n        top = undefined;\n      } else {\n        top = pos.parentHeight - size.tooltipHeight;\n      }\n\n      bottom = pos.parentHeight - pos.y;\n    }\n\n    if (right && right + size.tooltipWidth > pos.parentWidth) {\n      if (pos.hasParent) {\n        right = undefined;\n      }\n      left = 0;\n    }\n\n    if (bottom && bottom + size.tooltipHeight > pos.parentHeight) {\n      if (pos.hasParent) {\n        bottom = undefined;\n      }\n      top = 0;\n    }\n  }\n\n  const Content = (\n    <Base\n      data-type=\"tooltip-content\"\n      ref={ref}\n      style={{\n        left,\n        right,\n        top,\n        bottom,\n        ...(!pos.hasParent && { position: 'fixed' }),\n        ...(!size && { zIndex: -1 }),\n      }}\n    >\n      {children(pos, size)}\n    </Base>\n  );\n  const e = document.querySelector(`#${pos.portalId}`) as Element | undefined;\n  if (!pos.hasParent && e) {\n    return createPortal(Content, e);\n  }\n  return Content;\n};\n\ntype ITooltipProps = {\n  /** default 'ag-tooltip-portal' */\n  portalId: string;\n};\n\nexport interface IUseTooltip<T> {\n  Comp: <T>({\n    pos,\n    children,\n  }: {\n    pos: IPos<T> | undefined;\n    children: (pos: IPos<T>, size?: IPosSize) => JSX.Element;\n  }) => JSX.Element | null;\n  setPos: (\n    p?:\n      | {\n          element: MouseEvent;\n          parent: Element | null;\n          data: T;\n        }\n      | undefined,\n  ) => void;\n  pos: IPos<T> | undefined;\n}\n\nexport const useTooltip = <T,>(p?: ITooltipProps): IUseTooltip<T> => {\n  const portalId = p?.portalId || 'ag-tooltip-portal';\n  const [pos, setPosRaw] = useState<IPos<T>>();\n\n  useEffect(() => {\n    if (document.querySelectorAll(`#${portalId}`).length > 0) {\n      return;\n    }\n    const d = document.createElement('div');\n    d.id = portalId;\n    document.body.appendChild(d);\n    return () => {\n      try {\n        document.querySelector(`#${portalId}`)?.remove();\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n      } catch (e) {\n        //\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const setPos = (p?: {\n    element: MouseEvent;\n    parent: Element | null;\n    data: T;\n  }) => {\n    if (!p) {\n      setPosRaw(undefined);\n      return;\n    }\n\n    let parentTop = 0;\n    let parentLeft = 0;\n    let parentWidth = document.body.clientWidth;\n    let parentHeight = document.body.clientHeight;\n    let x = 0;\n    let y = 0;\n\n    if (p.parent) {\n      ({\n        top: parentTop,\n        left: parentLeft,\n        width: parentWidth,\n        height: parentHeight,\n      } = p.parent.getBoundingClientRect());\n      x = p.element.pageX - parentLeft;\n      y = p.element.pageY - parentTop;\n    } else {\n      parentWidth = window.innerWidth;\n      parentHeight = window.innerHeight;\n      x = p.element.clientX;\n      y = p.element.clientY;\n    }\n\n    const p2 = {\n      cursor: p.element,\n      data: p.data,\n      parentWidth,\n      parentHeight,\n      x,\n      y,\n      hasParent: !!p.parent,\n      portalId,\n    };\n\n    setPosRaw(p2);\n  };\n\n  return {\n    Comp,\n    setPos,\n    pos,\n  };\n};\n","'use client';\nimport { css } from '@emotion/react';\nimport styled from '@emotion/styled';\nimport type { CSSProperties } from 'react';\n\nimport { colours } from './colours';\n\n/** function that returns css that gives a text outline drop shadow.\n * @param outlineColour default='white'\n * @param sizePx default = 1px\n */\nexport const HardOutline = (outlineColour = 'white', sizePx = 1) => css`\\\nfilter: ${HardOutlineFilter(outlineColour, sizePx)};\n`;\n\nexport const HardOutlineFilter = (outlineColour = 'white', sizePx = 1) => {\n  const px = `${sizePx}px`;\n\n  return `drop-shadow(${px} ${px} 0px ${outlineColour})\n  drop-shadow(-${px} ${px} 0px ${outlineColour})\n  drop-shadow(${px} -${px} 0px ${outlineColour})\n  drop-shadow(-${px} -${px} 0px ${outlineColour})`;\n};\n\n/** disable user text selection */\nexport const NoTextSelect = css`\n  user-select: none; /* supported by Chrome and Opera */\n  -webkit-user-select: none; /* Safari */\n  -khtml-user-select: none; /* Konqueror HTML */\n  -moz-user-select: none; /* Firefox */\n  -ms-user-select: none; /* Internet Explorer/Edge */\n`;\n\n/** enable text overflow\n * @param lines number of lines before overflow\n */\nexport const TextOverflowEllipsis = (lines: number) => css`\n  display: -webkit-box;\n  -webkit-line-clamp: ${lines};\n  -webkit-box-orient: vertical;\n  overflow: hidden;\n  text-overflow: ellipsis;\n`;\n\n/** stop dragging of element */\nexport const noDrag: {\n  draggable: boolean;\n  onDragStart: React.DragEventHandler<HTMLDivElement>;\n  onTouchStart: React.TouchEventHandler<HTMLDivElement>;\n} = {\n  draggable: false,\n  onDragStart: (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n  },\n  onTouchStart: (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n  },\n};\n\n/** apply bounce effect given a condition */\nexport const bounce = (bounceattr: string) => css`\n  transition:\n    opacity 0.2s ease,\n    transform 0.2s cubic-bezier(0.02, 1.5, 0.74, 1.23);\n  transform-origin: 50% 50%;\n  transform: translateY(-5px);\n  &[${bounceattr}='true'] {\n    transform: translateY(0);\n  }\n`;\n\nexport const Card = styled.div`\n  background-color: white;\n  margin: 0.5rem;\n\n  position: relative;\n  border-radius: 0.5rem;\n  max-width: 40rem;\n  padding: 1rem;\n  border: solid 2px ${colours.lighter};\n`;\n\nexport interface IVarStyles {\n  /** default var(--main-fg) */\n  color: string;\n  /** default var(--main-bg) */\n  backgroundColor: string;\n  /** default var(--main-bg-mid) */\n  borderColor: string;\n}\n\nexport const getVarStyles = (\n  raw?: Partial<IVarStyles & CSSProperties>,\n): IVarStyles => ({\n  ...raw,\n  color: raw?.color ?? 'var(--main-fg)',\n  backgroundColor: raw?.backgroundColor ?? 'var(--main-bg)',\n  borderColor: raw?.borderColor ?? 'var(--main-bg-mid)',\n});\n","'use client';\nimport styled from '@emotion/styled';\n\nimport { smallScreen } from './media';\n\nexport const SOBase = styled.div`\n  display: flex;\n  width: 100%;\n  flex-grow: 1;\n  flex-flow: column;\n  overflow: hidden;\n  align-content: flex-start;\n  align-items: flex-start;\n\n  > h1,\n  h2,\n  > p {\n    white-space: pre-wrap;\n    font-size: 1.2rem;\n  }\n  h1,\n  h2 {\n    font-weight: normal;\n    font-size: 2rem;\n    flex-basis: 100%;\n    margin: 0;\n  }\n`;\n\nexport const SOBR = styled.div`\n  height: 0.5rem;\n  width: 0.5rem;\n`;\n\nexport const SOB = styled.div`\n  font-size: 1.4em;\n  font-weight: bold;\n`;\n\nexport const SOP = styled.div`\n  margin-bottom: 1rem;\n`;\n\nexport const SOCenter = styled.div`\n  display: flex;\n  flex-flow: column;\n  margin-left: auto;\n  margin-right: auto;\n  @media ${smallScreen} {\n    width: calc(100% - 2rem);\n  }\n`;\n\nexport const SOA = styled.a`\n  width: fit-content;\n  color: rgb(125, 171, 255);\n  text-decoration: none;\n  &:hover {\n    text-decoration: underline;\n  }\n  &[data-inline='true'] {\n    display: inline-block;\n    margin-left: 5px;\n    margin-right: 5px;\n  }\n  &[data-inline='false'] {\n    display: flex;\n    margin: auto;\n  }\n`;\n"],"names":[],"sourceRoot":""}